{% extends "base.html" %}
{% block content %}

<h1 style="margin-bottom: 1.5rem;">üé• Cortana Dashboard</h1>

<section style="margin-bottom: 2rem;">
  <h2>üìä Overview</h2>
  <div style="display: flex; gap: 2rem; flex-wrap: wrap; font-size: 1.1em;">
    <div><strong>Total Videos:</strong> {{ stats.total_videos }}</div>
    <div><strong>Total Frames:</strong> {{ stats.total_frames }}</div>
    <div><strong>Indexed Frames:</strong> {{ stats.indexed_frames }}</div>
  </div>
</section>

<section style="margin-bottom: 2rem;">
  <h2>üéû Processing Status</h2>
  {% if videos %}
  <table id="videos-table" border="1" cellspacing="0" cellpadding="6" style="border-collapse: collapse; width: 100%; font-size: 0.95em;">
    <thead style="background: #f5f5f5;">
      <tr>
        <th style="text-align:left;">Video ID</th>
        <th style="text-align:left;">Filename</th>
        <th>Total Frames</th>
      </tr>
    </thead>
    <tbody>
      {% for v in videos %}
      <tr data-video-id="{{ v.video_id }}">
        <td>{{ v.video_id }}</td>
        <td>{{ v.filename }}</td>
        <td style="text-align:center;" class="total">{{ v.total_frames }}</td>
   
    
        <td style="text-align:center;">
          <a href="/dashboard/video/{{ v.video_id }}" style="text-decoration:none; color:#007BFF;">View Frames</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No videos uploaded yet.</p>
  {% endif %}
</section>

<div style="margin-top: 3rem; text-align:center;">
  <a href="/search" 
     style="padding: 0.8em 1.5em; background:#007BFF; color:white; border-radius:8px; text-decoration:none; font-weight:500;">
     üîç Go to Search
  </a>
</div>

<script>
// Auto-refresh progress for each video every 5s
async function refreshProgress() {
  const rows = document.querySelectorAll('#videos-table tbody tr');
  for (const row of rows) {
    const videoId = row.dataset.videoId;
    const resp = await fetch(`/dashboard/video/${videoId}/status`);
    const data = await resp.json();
    if (data && data.status !== "not_found") {
      row.querySelector('.total').textContent = data.total_frames;
      row.querySelector('.processed').textContent = data.processed_frames;
      row.querySelector('.progress-fill').style.width = `${data.progress}%`;
      row.querySelector('.progress-text').textContent = `${data.progress}%`;
      const statusCell = row.querySelector('.status');
      if (data.status === "ready") {
        statusCell.innerHTML = "<span style='color:green; font-weight:bold;'>‚úÖ Ready</span>";
      } else if (data.status === "processing") {
        statusCell.innerHTML = "<span style='color:orange; font-weight:bold;'>‚è≥ Processing</span>";
      } else {
        statusCell.innerHTML = "<span style='color:gray;'>Queued</span>";
      }
    }
  }
}

setInterval(refreshProgress, 5000);
</script>

{% endblock %}
