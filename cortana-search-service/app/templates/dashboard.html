{% extends "base.html" %}
{% block content %}

<h1>üé• Cortana Dashboard</h1>

<form method="get" action="/dashboard/search" style="margin-bottom: 2rem;">
  <input type="text" name="q" value="{{ query }}" placeholder="Search OCR text..." autofocus
         style="padding: 0.6em; width: 60%; border-radius: 8px; border: 1px solid #ccc;">
  <button type="submit" style="padding: 0.6em 1em; border-radius: 8px;">Search</button>
</form>

<section style="margin-bottom: 2rem;">
  <h2>üìä Overview</h2>
  <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
    <div><strong>Total Videos:</strong> {{ stats.total_videos }}</div>
    <div><strong>Total Frames:</strong> {{ stats.total_frames }}</div>
    <div><strong>Indexed Frames:</strong> {{ stats.indexed_frames }}</div>
  </div>
</section>

<section style="margin-bottom: 2rem;">
  <h2>üéû Video Progress</h2>
  {% if videos %}
  <table border="1" cellspacing="0" cellpadding="6" style="border-collapse: collapse; width: 100%;">
    <thead style="background: #f5f5f5;">
      <tr>
        <th>Video ID</th>
        <th>Filename</th>
        <th>Total Frames</th>
        <th>Processed</th>
        <th>Progress</th>
        <th>View</th>
      </tr>
    </thead>
    <tbody>
      {% for v in videos %}
      <tr>
        <td>{{ v.video_id }}</td>
        <td>{{ v.filename }}</td>
        <td>{{ v.total_frames }}</td>
        <td>{{ v.processed_frames }}</td>
        <td>
          <div style="background:#ddd; border-radius:6px; width:100%; height:10px; position:relative;">
            <div style="background:#4CAF50; width:{{ v.progress or 0 }}%; height:10px; border-radius:6px;"></div>
          </div>
          <small>{{ v.progress or 0 }}%</small>
        </td>
        <td style="text-align:center;">
          <a href="/dashboard/video/{{ v.video_id }}">View Frames</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No videos found yet.</p>
  {% endif %}
</section>

{% if query %}
  <section style="margin-top: 3rem;">
    <h2>üîç Results for ‚Äú{{ query }}‚Äù</h2>
    {% if results %}
      <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:1.2rem;">
        {% for r in results %}
        <div style="border:1px solid #ddd; padding:1rem; border-radius:8px; background:#fafafa;">
          <a href="{{ r['frame_url'] }}" target="_blank" title="{{ r['filename'] }}">
            <img src="{{ r['frame_url'] }}" alt="{{ r['filename'] }}" style="width:100%; border-radius:6px; margin-bottom:0.5rem;">
          </a>
          <strong>{{ r['video_id'] }}</strong><br>
          <small>{{ r['filename'] }}</small>
          <p style="font-size:0.9em; margin-top:0.5rem;">{{ r['snippet']|safe }}</p>
        </div>
        {% endfor %}
      </div>

      <div style="margin-top:1em; text-align:center;">
        {% if page > 1 %}
          <a href="?q={{ query }}&page={{ page - 1 }}&page_size={{ page_size }}">‚¨Ö Prev</a>
        {% endif %}
        <span> Page {{ page }} / {{ total_pages }} ({{ total }} results)</span>
        {% if page < total_pages %}
          <a href="?q={{ query }}&page={{ page + 1 }}&page_size={{ page_size }}">Next ‚û°</a>
        {% endif %}
      </div>
    {% else %}
      <p>No matches found.</p>
    {% endif %}
  </section>
{% endif %}

{% endblock %}
